<!DOCTYPE html>

<html>
  <head>

  </head>

  <!-- Begin -->
  <body>
    <div style="width: 800px; height: 500px;">

      <!-- Game portion of the interface -->
      <div id="gameDiv" oncontextmenu="return false;" style="width: 500px; height: 500px; float: left; border:none; overflow: hidden;" scrolling="no">
        <canvas id="myCanvas" width="500" height="500" background-color="#87CEEB"></canvas>
      </div>


      <!-- Chatting portion of the interface -->
      <div id="chatDiv" style="width: 300px; height: 500px; border:none; overflow: hidden;" scrolling="no">

        <!-- Chat Window -->
        <form id="chatForm">
           <select id="chatSelect" size="20" form="chatForm" style="height: 100%; width: 100%; overflow: hidden;"> -->
           </select>
         </form>

          <!-- Chatbox and Send button prototypes -->


        <input type="text" id="msg">
        <button type="submit" onclick="sendMessage()">Send</button>


      </div>
    </div>

    <script type="text/javascript">

      //
      // Communicate with the Web Server
      //

      function httpPost(url, payload, callback) {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
          if(request.readyState == 4) {
            if(request.status == 200) {
              callback(request.responseText);
            } else {
              if(request.status == 0 && request.statusText.length == 0)
                console.log("No partner to send message to!");
              else
                alert("Server returned status " + request.status +
                  ", " + request.statusText);
            }
          }
        };
        request.open('POST', url, true);
        request.setRequestHeader('Content-Type',
          'application/x-www-form-urlencoded');
        console.log(payload);
        request.send(payload);
      }

      function httpGet(url, callback) {
        var getRequest = new XMLHttpRequest();
        getRequest.onreadystatechange = function() {
            if (getRequest.readyState == 4 && getRequest.status == 200)
                callback(getRequest.responseText);
        }
        getRequest.open("get", url, true); // true for asynchronous
        getRequest.send();
      }

      function updateFrontEnd(response) {
        console.log(response);
        //document.getElementById("chatHistory").src = "chat_history.html";
        var x = document.getElementById("chatSelect");
        x.innerHTML='<object type="text/html" data="chat_history.html"></object>';
        x.scrollTop = x.scrollHeight;
      }

      function sendToBackEnd(data) {
        httpPost("chat_history.html", "<option>" + data.value + "</option>", updateFrontEnd);
        //httpGet("stuff.html", cb);
      }

      // Send a chat message to the server
      function sendMessage() {
        var msg = document.getElementById("msg");
        if(msg.value != "") {
          sendToBackEnd(msg);
          msg.value = "";
        }
      }

      // Ping the server for new messages on an interval
      //let timer = setInterval(function() { httpGet("chat_history.html", updateFrontEnd) }, 1200);
    </script>
  </body>
</html>
