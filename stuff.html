<!DOCTYPE html>

<html>
  <head>

  </head>

  <!-- Begin -->
  <body>
    <div style="width: 800px; height: 500px;">

      <!-- Game portion of the interface -->
      <div id="game" oncontextmenu="return false;" style="width: 500px; height: 500px; float: left; border:none; overflow: hidden;" scrolling="no">
        <canvas id="myCanvas" width="500" height="500" background-color="#87CEEB"></canvas>
      </div>


      <!-- Chatting portion of the interface -->
      <div id="chat" style="width: 300px; height: 500px; border:none; overflow: hidden;" scrolling="no">

        <!-- Chat Window -->
        <form>
          <select id="history" size="20" form="chat" style="height: 100%; width: 100%; overflow: hidden;">
          </select>

          <!-- Chatbox and Send button prototypes -->
          <input type="text" name="message" id="msg">
          <input type="submit" onclick="sendMessage()" value="Send">
        </form>

      </div>
    </div>

    <script type="text/javascript">

      //
      // Communicate with the Web Server
      //

      function httpPost(url, payload, callback) {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
          if(request.readyState == 4) {
            if(request.status == 200) {
              callback(request.responseText);
            } else {
              if(request.status == 0 && request.statusText.length == 0)
                console.log("No partner to send message to!");
              else
                alert("Server returned status " + request.status +
                  ", " + request.statusText);
            }
          }
        };
        request.open('POST', url, true);
        request.setRequestHeader('Content-Type',
          'application/x-www-form-urlencoded');
        request.send(payload);
      }

      function httpGet(url, callback) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function() {
            if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                callback(xmlHttp.responseText);
        }
        xmlHttp.open("GET", url, true); // true for asynchronous
        xmlHttp.send(null);
      }

      function updateFrontEnd(response) {

        document.getElementById("history").innerHTML='<object type="text/html" data="chat_history.html"></object>';
        console.log(reponse);
        //console.log(response.responseText);
        var x = document.getElementById("history");
        var option = document.createElement("option");
        //option.text = response.value; //response.responseText;
        x.add(response);
  		  x.scrollTop = x.scrollHeight;
      }

      function sendToBackEnd(data) {
        console.log(data);
        httpPost("stuff.html", "<option>" + data.value + "</option>", updateFrontEnd);
        //httpGet("stuff.html", cb);
      }

      //
      // The implementation for the chat mechanic
      //

      function sendMessage() {
        var msg = document.getElementById("msg");
        console.log(msg.value);
        if(msg.value != "") {
          sendToBackEnd(msg);
          msg.value = "";
        }
      }
    </script>
  </body>
</html>
